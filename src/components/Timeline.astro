---
import "./Timeline.css";

import { getEntry, render } from "astro:content";

type CollectionName = keyof import("astro:content").DataEntryMap;

type Props = {
  collectionName?: CollectionName;
  entryName: string;
};

const { collectionName = "timeline", entryName } = Astro.props;

const entry = await getEntry(collectionName, entryName);

if (!entry) {
  throw new Error(`${entryName} entry not found`);
}

const { Content } = await render(entry);
---

<div class="timeline-content my-7 opacity-0">
  <Content />
</div>

<script>
  const tagContainers = Array.from(document.querySelectorAll("ul")).filter(
    (ul) =>
      Array.from(ul.children).some(
        (li) => li.tagName === "LI" && li.firstElementChild?.tagName === "CODE",
      ),
  );
  tagContainers.map((container) => {
    container.classList.add("tag-container");
  });

  const unorderedLists = Array.from(document.querySelectorAll("ul"));
  const outermostUnorderedLists = unorderedLists.filter(
    (ul) => !ul.parentElement || !ul.parentElement.closest("ul"),
  );

  outermostUnorderedLists.map((ul) => {
    ul.classList.add("timeline-list");
  });

  // for solving the FOUC issue (with the rendering)
  const contentWrappers = Array.from(
    document.getElementsByClassName("timeline-content"),
  );
  console.log(contentWrappers);
  contentWrappers.map((wrapper) => {
    wrapper.classList.toggle("opacity-0");
  });
</script>
